<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anywhere test</title>
</head>
<body>
    <h1>Check out anywhere</h1>
    <p>Take courses and such</p>
    <div class="row" style="display: none;" id="luEmbedFormDiv"></div>
    <div class="row">
    <div class="col" style="padding-top: 34px; padding-left:40px">
    <div id="main">
    <script>
// Function to prompt for the email, generate timestamp, and token
async function generateForm() {
// Prompt user for email
const email = prompt("Please enter your email:", "jondoe@example.com");
if (!email) {
    alert("Email is required.");   
    return;
    }

// Get the current Unix timestamp
const timestamp = Math.floor(Date.now() / 1000); // Unix timestamp in seconds
    
// Static key
const key = "e4e2f04b5716148a48c1f4577c";
    
// Create the SSO token string
const tokenData = `USER=${email}&TS=${timestamp}&KEY=${key}`;
    
// Create the SHA-256 hash
const hashBuffer = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(tokenData));
const hashArray = Array.from(new Uint8Array(hashBuffer));
const token = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

// Construct the final URL
const url = `https://webhooksportal.com/sqsso?Email=${email}&TS=${timestamp}&SSOToken=${token}`;

var formElements = []; // Represents all the elements a form will have
var form = document.createElement('form');
form.setAttribute('method', 'post');
form.setAttribute('action', url);
form.setAttribute('target', 'luEmbedIframe'); // You'll need a target so iFrame knows what to use
form.setAttribute('id', 'luEmbedForm')


// Create each element need for your type of authentication, aka SSO or SAML, and push them to the array
// In the example of SSO, you would need inputs for Email, TS, SSOToken, forEmbed and redirect_uri
// Here only 'forEmbed' param is pushed
var forEmbed = document.createElement('input');
forEmbed.setAttribute('type', 'text');
forEmbed.setAttribute('name', 'forEmbed');
forEmbed.setAttribute('value', 'true');
formElements.push(forEmbed);


var submitBtn = document.createElement('input');
submitBtn.setAttribute('type', 'submit');
submitBtn.setAttribute('value', 'Submit');
formElements.push(submitBtn)


// Push all the elements needed into the form
formElements.forEach(item => form.appendChild(item));


var mainForm = document.getElementById('luEmbedFormDiv');
if (mainForm) {
   mainForm.innerHTML = '';
   mainForm.appendChild(form);// Append the form to HTML
}


var iframe = document.createElement('iframe');
iframe.setAttribute('style', 'width:100%;height:1000px;border-width:0px;');
iframe.setAttribute('scrolling', 'yes');
iframe.setAttribute('allowFullScreen', 'true');
iframe.setAttribute('name', 'luEmbedIframe');
iframe.setAttribute('allow', 'camera *; microphone *');// We need this in case you have allowed Learners to record assignment videos. Altho, we suggest allowing only your portals subdomain here.


var main = document.getElementById('main');
if (main) {
   main.innerHTML = '';
   main.appendChild(iframe);// Append the iFrame


   var embededForm = document.getElementById('luEmbedForm');
   embededForm.submit();// Submit the form
   mainForm.innerHTML = '';// Remove the form from HTML
}

    </script>
</body>
</html>
